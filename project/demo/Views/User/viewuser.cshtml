@model IEnumerable<demo.Models.regModel>

@using System.Diagnostics

@{
    ViewBag.Title = "get";
    ViewData["Title"] = "viewuser";


}
<head>
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>


        * {
        box-sizing: border-box;
        }

        body {
        margin: 0;
        padding: 0;
        background: #fff;
        font-family: Raleway;
        text-transform: uppercase;
        font-size: 11px;
        }

        h1 {
        margin: 0;
        }


  table {
    width: 100%;
    border-collapse: collapse;
  }

  th, td {
    padding: 10px;
    border: 1px solid #ccc;
    text-align: center;
  }

 
th:nth-child(1),
thead:nth-child(2),
td:nth-child(1),
td:nth-child(2) {
    position: sticky;
    left: 0;
    background-color: #fff;
    z-index: 9;

}



        .contact {
        -webkit-user-select: none; /* Chrome/Safari */
        -moz-user-select: none; /* Firefox */
        -ms-user-select: none; /* IE10+ */
        margin: 1em auto;
        width: 100px;
        height: 30px;
        line-height: 13px;
        background: teal;
        color: white;
        font-weight: 700;
        text-align: center;
        cursor: pointer;
        border: 1px solid white;
        }

        .contact:hover {
        background: #666;
        }

        .contact:active {
        background: #444;
        }

        .contactForm {
        display: none;
        border: 6px solid  #55ff88;
        padding: 2em;
        width: 500px; /* Adjust width as needed */
        height: 500px;

        background: #fff;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%,-50%);
        -webkit-transform: translate(-50%,-50%)
        }

        input, textarea {
        margin: .8em auto;
        font-family: inherit;
        text-transform: inherit;
        font-size: inherit;
        display: block;
        width: 280px;
        padding: .4em;
        }

        textarea {
        height: 80px;
        resize: none;
        }
        tr {
    margin-bottom: 1px; /* Adjust the margin to decrease space between rows */
}
        .formBtn {
        width: 140px;
        display: inline-block;
        background: teal;
        color: #fff;
        font-weight: 100;
        font-size: 1.00em;
        border: none;
        height: 30px;
        }
     
        .Btn{

        }
        .verifyPopup {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        -webkit-transform: translate(-50%, -50%);
        background: #fff;
        border: 6px solid #55ff88; /* Adjust border color as needed */
        padding: 2em;
        width: 500px; /* Adjust width as needed */
        height: 500px; /* Adjust height as needed */
        z-index: 1000;
        text-align: center; /* Align content center */
    }

    .verifyPopup h1 {
        margin: 0;
        font-size: 24px;
        margin-bottom: 72px;
    }

    .verifyPopup label {
        display: block;
        margin-bottom: 5px;
        text-align: left; /* Align labels left */
        margin-top: 18px;
    }

    .verifyPopup input[type="text"],
    .verifyPopup input[type="number"],
    .verifyPopup input[type="date"] {
        width: calc(100% - 20px); /* Adjust width to fit container */
        padding: 10px;
        font-size: 16px;
        margin-bottom: 20px;
        border: 1px solid #ccc;
        border-radius: 5px;
        margin: 0 auto; /* Center input fields */
        display: block;
    }

    .verifyPopup button {
        background-color: #007bff;
        color: #fff;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        font-size: 16px;
        cursor: pointer;
        margin-top: 20px; /* Add space between input fields and button */
    }

    .verifyPopup button:hover {
        background-color: #0056b3;
    }
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"> </script>
    <link rel="stylesheet" href="path/to/font-awesome/css/all.min.css">

    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>




    <!-- Page Heading -->
    <h1 align="center" class="h3 mb-2 text-gray-800">Registered Users</h1>


    <div class="card shadow mb-4">

        <div class="card-header py-3">
            <h6 class="m-0 font-weight-bold text-primary"> <a href="/Register/Index">Create New User</a><br><br>
                Terms :
                <select id="termSelect" value="@ViewBag.seleceterdterm.TermId" style="padding: 5px;border-radius: 5px;
    padding: 8px 15px; 
    border: 1px solid #ccc; 
    font-size: 14px; 
    background-color: #fff;">
                    @if (ViewBag.TermsListt != null)
                    {
                        @foreach (var terms in ViewBag.TermsListt)
                        {
                            <option value="" disabled selected>Select Term</option>
                        }

                    }
                    @if (ViewBag.TermsList != null)
    {
   @foreach (var term in ViewBag.TermsList)
    {
                            if (ViewBag.seleceterdterm.TermId==term.TermId)
                            {
                                 <option value="@term.TermId" data-amount="@term.amount" selected>@term.Term</option>
                            }
                            else
                            {
                                 <option value="@term.TermId" data-amount="@term.amount">@term.Term</option>
                            }
                           
    }
    }
    else
    {
        <option>No terms available</option>
    }
                    </select>

             
                    
       

                        </div>

     <div class="card-body">
                            <div class="table-responsive .table-container">
                    <div x-data="{ showAlert: function() { alert('hi'); } }">
                        <table class="table table-bordered " id="dataTable"  width="100%" cellspacing="0">
                                    <thead >
                                        @* <tr><a id="add" asp-action="Create" class="button">Create New</a></tr> *@
                                        <tr>
                                            <th >
                                                
                                                Registration Id
                                            
                                            </th>
                                           @*  <th >
                                                @Html.DisplayNameFor(model => model.FirstName)
                                            </th> *@
                                            <th >
                                                @* @Html.DisplayNameFor(model => model.LastName) *@
                                                Name
                                            </th>
                                            <th >
                                                @Html.DisplayNameFor(model => model.Address)
                                            </th>
                                            <th >Ward</th>
                                            <th>
                                                @Html.DisplayNameFor(model => model.City)
                                            </th>
                                            <th >
                                                @Html.DisplayNameFor(model => model.Country)
                                            </th>
                                            <th >
                                                @Html.DisplayNameFor(model => model.Phone)
                                            </th>
                                            <th >
                                               Residence Phone Number
                                             </th>
                                            <th >
                                              @Html.DisplayNameFor(model => model.Gender)
                                            </th>
                                           @*  <th>
                                                    @Html.DisplayNameFor(model => model.userImage)
                                            </th> *@
                                            <th >
                                                Age

                                            </th>
                                        <th >
                                          Date Of Birth

                                           </th>
                                           <th ></th>
                                            <th ></th>
                                            <th ></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                @foreach (var item in Model)
                    {

                                        <tr style="height: 40px !important;">
                                            <td >
                                                 @Html.DisplayFor(modelItem => item.RegistrationId)
                                            </td>
                                          @*   <td>
                                  
                                                @Html.DisplayFor(modelItem => item.FirstName)
                                    
                                            </td> *@
                                            <td >
                                                 @Html.DisplayFor(modelItem => item.FirstName) @Html.DisplayFor(modelItem => item.LastName)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.Address)
                                            </td>
                            <td> @item.Ward</td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.City)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.Country)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.Phone)
                                                </td>
                                              <td>
                                                 @Html.DisplayFor(modelItem => item.AbroadPhone)
                                             </td>
                            @* <td>
                                @{
                                    string genderDisplay = "";

                                   
                                    if (item.Gender != null)
                                    {
                                        if (item.Gender.Equals(demo.Areas.Identity.Data.Gender.Male))
                                        {
                                            genderDisplay = "Male";
                                        }
                                        else if (item.Gender.Equals(demo.Areas.Identity.Data.Gender.Female))
                                        {
                                            genderDisplay = "Female";
                                        }
                                       
                                    }
                                    else
                                    {
                                        genderDisplay = "Undefined"; 
                                    }

                                    
                                    @genderDisplay
                                }
                            </td> *@

                        

                                           <td>
                                                        @Html.DisplayFor(modelitem => item.Gender)
                                            </td> 
                                            <td>
                                                @Html.DisplayFor(modelitem => item.Age)
                                            </td>
                                            <td>
                                                 @Html.DisplayFor(modelitem => item.DateOfBirth)
                                             </td>
                                            <td>
                               @*  @Html.ActionLink("Edit","Index", "Register", new {  id=item.Id },new { @class = "btn btn-sm btn-primary edit-link" })  *@
                              <a href="@Url.Action("Index", "Register", new { id = item.Id })" class="btn btn-sm btn-primary edit-link" style="color: white;">
    <i class="fas fa-edit"></i> 
</a>



                                                        @* @Html.ActionLink("Details", "Details", new { /* id=item.PrimaryKey */ }) | *@
                                                   @*@Html.ActionLink("Delete", "viewuser","User", new { onclick = "return confirm('Are you sure you want to delete this user?');" }) *@
                               @*   @Html.ActionLink("Delete", "Delete", "Delete", new { id = item.Id }, new { onclick = "return confirm('Are you sure you want to delete this user?');" ,@class = "btn btn-sm btn-danger edit-link" } )  *@
                               <a href="@Url.Action("Delete", "Delete", new { id = item.Id })" onclick="return confirm('Are you sure you want to delete this user?');" class="btn btn-sm btn-danger edit-link" style="color: white;">
    <i class="fas fa-trash"></i>
</a>


                                </td>

                                <td>

                                       <div id="codeDisplay">
    @{
        var userExistsDict = ViewBag.UserExists as Dictionary<string, bool>;
        var userVerificationDict = ViewBag.UserVerification as Dictionary<string, bool>;

        if (userExistsDict != null && userVerificationDict != null)
        {
            string itemId = item.Id.ToString();

            bool paymentExists = userExistsDict.ContainsKey(itemId) && userExistsDict[itemId];
            bool paymentVerified = userVerificationDict.ContainsKey(itemId) && userVerificationDict[itemId];

            if (paymentExists && paymentVerified)
            {
                <!-- If payment exists and is verified, display a "Verified" button -->
                <button  class="btn btn-sm btn-success" id="verified" disabled>Verified</button>
            }
            else if (paymentExists)
            {
                <!-- If payment exists but not verified, display a "Verify" button -->
                // <button class="btn btn-sm btn-danger verifyButton" id="verify" data-itemid="@item.Id" >Verify</button>
		 <button  class="btn btn-sm edit-link btn-danger contact verifyButton" id="verify" data-itemid="@item.Id">Verify</button>

            }
            else
            {
                <!-- If payment doesn't exist, display the "Pending" button -->
                // <button class="btn btn-sm btn-primary contact" id="contact" data-itemid="@item.Id">Pending</button>
                  <button  class="btn btn-sm btn-primary edit-link contact" id="contact" data-itemid="@item.Id">Pending</button>
            }
        }
    }
</div>
                            </td>
<td>
   <a asp-controller="IdCard" asp-action="Index" asp-route-id="@item.Id">
    <i class="fas fa-file-pdf fa-lg" style="color: red; background-color: white;"></i>
</a>

</td>


                            
                                        </tr>
                            }
                                    </tbody>
                                </table>
                   </div>
                            </div>
                        </div>
                    </div>

    
                                            
                                     
 
</body>

<div class="contactForm" align="center"  style="display: none;">
        <h1>Make Payment!</h1>
        @*  <small>I'll get back to you as quickly as possible</small> *@
        <br />
        <br />
        <div>
             <input type="hidden"  id="hiddenTermId" name="hiddenTermId" value="">

        </div>
        <div>
            <input type="hidden" id="hiddenUserId" name="hiddenUserId" value="itemid">

        </div>

        @*     <div style="width: 300px;height: 80px;color: black;">
        <h6 class="m-0 font-weight-bold text-primary">v*@
             <h6 class="m-0 font-weight-bold text-primary">Term :</h6>
    
                   <input id="term" class="form-control"  value="" type="text" style="width:200px;height:20px;font-size: 15px;" required readonly> 

        <br />
        <br />
        <div>
            <h6 class="m-0 font-weight-bold text-primary">Amount :</h6>
      
    <input  id="amountInput" class="form-control" value="" type="number" style="width:200px;height:20px;font-size: 15px;" required readonly>
        </div>

    <div>
            <h6 class="m-0 font-weight-bold text-primary">Reference number :</h6>
      
    <input  id="referenceid" class="form-control" value="" type="text" style="width:200px;height:20px;font-size: 15px;" required>
        </div>
        
        <div style="width: 300px;height: 80px;color: black;">
            <h6 class="m-0 font-weight-bold text-primary"> Type :</h6>


            <select id="paymentType" class="form-control"  style="width:200px;height:30px;font-size: 15px;">


                <option class="custom-select" value="0">Cash</option>
                <option class="custom-select" value="1">Card</option>

            </select>
        </div>
        <div style="width: 300px;height: 80px;color: black;">
            <h6 class="m-0 font-weight-bold text-primary">
                Date :
            </h6>

            <input id="DateOfBirth" type="date" class="form-control" required style="width:200px;height:20px;font-size: 15px;" >
        </div>

        <input id="submitBtn" class="formBtn" type="submit" value="PAY" />
    </div>

    <!-- HTML for the new popup -->
<!-- HTML for the new popup -->
<div class="verifyPopup" style="display: none;">
    <h1>Verify Payment</h1>
     <div>
             <input type="hidden"  id="hiddenTermId" name="hiddenTermId" value="">

        </div>
        <div>
            <input type="hidden" id="hiddenUserId" name="hiddenUserId" value="itemid">

        </div>
    <div>
        <label for="referenceId">Reference ID:</label>
        <input type="text" id="referenceId" name="referenceId">
    </div>
    <div>
        <label for="transactionDate">Transaction Date:</label>
        <input type="date" id="transactionDate" name="transactionDate">
    </div>
    <div>
        <label for="term">Term:</label>
        <input type="text" id="term" name="term">
    </div>
    <div>
        <label for="amount">Amount:</label>
        <input type="number" id="amount" name="amount">
    </div>
    <button id="verifyPayment">Verify</button>
</div>

<!-- HTML for the verification popup -->


 

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"> </script>

   <Script type="text/javascript">
  

//  $(document).ready(function () {
//     var urlParams = new URLSearchParams(window.location.search);

//     var contactForm = $('.contactForm');

//     $('.contact').click(function (event) {
//         event.stopPropagation(); // Prevents the click event from propagating to the document body
//         contactForm.fadeToggle();
//     });

//     $(document).on('click', function (event) {
//         // Check if the clicked element is not inside the contactForm
//         if (!contactForm.is(event.target) && !$('.contact').is(event.target) && contactForm.has(event.target).length === 0) {
//             contactForm.fadeOut();
//         }
//     });
//     //  $(document).on('click', function (event) {
//     //     if (!$(event.target).closest('.contactForm, .verifyPopup').length) {
//     //         $('.contactForm, .verifyPopup').fadeOut();
//     //     }
//     // });

//     // $('#verifyButton').click(function () {
//     //     // Show the verification popup for payment
//     //     $('.verifyPopup').fadeIn();
//     // });
       
//         // Update the term and amount when the pay button is clicked
//         $('.contact').click(function () {
//               var itemId = $(this).data('itemid');
//     console.log("Item ID: " + itemId);
//             var selectedOption = document.getElementById('termSelect');
//            var selectedTermId = selectedOption.options[selectedOption.selectedIndex].value;
      
//            console.log("Selected TermId: " + selectedTermId);
           
//             var selectedTerm = selectedOption.options[selectedOption.selectedIndex].text;
//             console.log("Selected Term: " + selectedTerm); 
//             var selectedAmount = selectedOption.options[selectedOption.selectedIndex].getAttribute('data-amount');
            
//             // Update the term and amount displayed in the contact form
//             $('#term').val(selectedTerm);
//             $('#amountInput').val(selectedAmount);
//              $('#hiddenTermId').val(selectedTermId);
//             $('#hiddenUserId').val(itemId);
            

//         /*     $('#contactForm').fadeToggle(); */ // Show the contact form
//         });
//    $('#verifyPayment').click(function () {
//         // Show the verification popup
//         $('.verifyPopup').fadeIn();

//         // You can set default values or perform any other initialization here
//         // For example:
//         $('#referenceId').val('');
//         $('#transactionDate').val('');
//         $('#term').val('');
//     });

//         // Update the amount when the select box changes
//         $('#termSelect').change(function () {
            
//             var selectedAmount = $(this).find(':selected').data('amount');
//             $('#amountInput').val(selectedAmount);
//             var selectedTermId = $(this).find(':selected').val();
//               window.location.href = '/User/viewuser?Tid=' + selectedTermId;
//             $('#hiddenTermId').val(selectedTermId);
//             var selectedTerm = $(this).find(':selected').text();
//             $('#term').val(selectedTerm);
         
//         });
//     });
//    $('#submitBtn').click(function (e) {
//     e.preventDefault(); // Prevent default form submission behavior

//     // Get values from the form elements
//     var amount =  parseInt($('#amountInput').val());
//     var term = $('#term').val();
//     var type = parseInt( $('#paymentType').val());
//     var date = $('#DateOfBirth').val();
//     var TermId = parseInt($('#hiddenTermId').val());
//     var UserId =$('#hiddenUserId').val();

     
//        // var itemId = $('#contact').val();
//     // Create an object with the form data
//     var paymentData = {
//         Amount: amount,
//         Term: term,
//         Type: type,
//         Date: date,
//         TermId:TermId,
//         UserId: UserId

//     };
//     console.log(JSON.stringify(paymentData));
//     // Send data to the controller using AJAX
//     $.ajax({
//         url: "/api/FetchAmount", // Replace with your controller action URL
//         type: 'POST',
//         contentType: 'application/json',
//         data: JSON.stringify(paymentData),
       

//         success: function (response) {
//             // Handle success (if needed)
           
//             console.log(response);
//             // Redirect to Terms Index page after successful payment
//             window.location.href = '/User/viewuser';
//         },
//         error: function (xhr, textStatus, errorThrown) {
//             // Handle error (if needed)
//             console.log(xhr.responseText);
//         }
//     });
      
// });
    


 </script>
<script type="text/javascript">
    $(document).ready(function () {
        var urlParams = new URLSearchParams(window.location.search);

        var contactForm = $('.contactForm');
        var verifyPopup = $('.verifyPopup');

        // Attach event handler for clicking on the contact button
        $('.contact').click(function (event) {
            event.stopPropagation(); // Prevents the click event from propagating to the document body
            contactForm.fadeToggle();
            verifyPopup.hide(); // Hide the verifyPopup if it's currently open
            var selectedOption = document.getElementById('termSelect');
            var selectedTermId = selectedOption.options[selectedOption.selectedIndex].value;
            $('#hiddenTermId').val(selectedTermId);
        });

        // Attach event handler for clicking outside the contact form or verification popup to close them
        $(document).on('click', function (event) {
            // Check if the click occurred outside the contact form and outside the verification popup
            if ((!contactForm.is(event.target) && !$('.contact').is(event.target) && contactForm.has(event.target).length === 0) &&
                (!verifyPopup.is(event.target) && !$('.verifyButton').is(event.target) && verifyPopup.has(event.target).length === 0)) {
                contactForm.fadeOut();
                verifyPopup.fadeOut();
            }
        });

        // Attach event handler for clicking the "Verify" button
        $('.verifyButton').click(function (event) {
    event.stopPropagation(); // Prevents the click event from propagating to the document body

    // Retrieve the data-itemid attribute value
    var itemId = $(this).data('itemid');
    console.log("Item ID: " + itemId);

    // Retrieve the termId from the hidden field
    var termId = parseInt($('#hiddenTermId').val());
    console.log("Term ID: " + termId);

    // Redirect to the verification page with item ID and term ID as parameters
    window.location.href = "/Verification/Verify?id=" + itemId + "&tid=" + termId;

    // Hide the contact form if it's currently open
    $('.contactForm').hide();
});
        // Update the term and amount when the pay button is clicked
        $('.contact').click(function () {
            var itemId = $(this).data('itemid');
            console.log("Item ID: " + itemId);
            var selectedOption = document.getElementById('termSelect');
            var selectedTermId = selectedOption.options[selectedOption.selectedIndex].value;

            console.log("Selected TermId: " + selectedTermId);

            var selectedTerm = selectedOption.options[selectedOption.selectedIndex].text;
            console.log("Selected Term: " + selectedTerm);
            var selectedAmount = selectedOption.options[selectedOption.selectedIndex].getAttribute('data-amount');

            // Update the term and amount displayed in the contact form
            $('#term').val(selectedTerm);
            $('#amountInput').val(selectedAmount);
            $('#hiddenTermId').val(selectedTermId);
            $('#hiddenUserId').val(itemId);
        });

        // Update the amount when the select box changes
        $('#termSelect').change(function () {
            var selectedAmount = $(this).find(':selected').data('amount');
            $('#amountInput').val(selectedAmount);
            var selectedTermId = $(this).find(':selected').val();
            // Remove or modify the following line to prevent automatic redirection
             window.location.href = '/User/viewuser?Tid=' + selectedTermId;
            $('#hiddenTermId').val(selectedTermId);
            var selectedTerm = $(this).find(':selected').text();
            $('#term').val(selectedTerm);
        });

        // Handle form submission
        $('#submitBtn').click(function (e) {
            e.preventDefault(); // Prevent default form submission behavior

            // Get values from the form elements
            var amount = parseInt($('#amountInput').val());
            var term = $('#term').val();
            var type = parseInt($('#paymentType').val());
            var date = $('#DateOfBirth').val();
            var TermId = parseInt($('#hiddenTermId').val());
            var UserId = $('#hiddenUserId').val();
            var Referenceid=$('#referenceid').val();
            
            // Create an object with the form data
            var paymentData = {
                Amount: amount,
                Term: term,
                Type: type,
                Date: date,
                TermId: TermId,
                UserId: UserId,
                referenceid:Referenceid,
            };

            console.log(JSON.stringify(paymentData));

            // Send data to the controller using AJAX
            $.ajax({
                url: "/api/FetchAmount", // Replace with your controller action URL
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(paymentData),
                success: function (response) {
                    // Handle success (if needed)
                    console.log(response);
                    // Redirect to Terms Index page after successful payment
                    window.location.href = '/User/viewuser';
                },
                error: function (xhr, textStatus, errorThrown) {
                    // Handle error (if needed)
                    console.log(xhr.responseText);
                }
            });
        });
    });
</script>
@*
<script>
    $(document).ready(function(){
        $(window).scroll(function(){
            var scroll = $(window).scrollTop();
            if (scroll >= 100) { // Adjust the scroll value as needed
                $("thead").addClass("sticky-header");
            } else {
                $("thead").removeClass("sticky-header");
            }
        });
    });
</script>*@